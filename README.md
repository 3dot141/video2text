# è§†é¢‘è½¬æ–‡å­—æœåŠ¡

ä¸€ä¸ªåŸºäº Node.js å’Œ OpenAI Whisper API çš„è§†é¢‘è½¬æ–‡å­—æœåŠ¡ï¼Œæ”¯æŒå¤šç§è§†é¢‘å’ŒéŸ³é¢‘æ ¼å¼çš„è½¬å½•ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ¥ æ”¯æŒå¤šç§è§†é¢‘æ ¼å¼ï¼šMP4ã€AVIã€MOVã€WMVã€FLV
- ğŸµ æ”¯æŒå¤šç§éŸ³é¢‘æ ¼å¼ï¼šMP3ã€WAVã€M4Aã€FLAC  
- ğŸŒ æ”¯æŒå¤šè¯­è¨€è½¬å½•ï¼ˆé»˜è®¤ä¸­æ–‡ï¼‰
- âš¡ è‡ªåŠ¨éŸ³é¢‘æå–ï¼ˆè§†é¢‘æ–‡ä»¶ï¼‰
- ğŸ§¹ æ™ºèƒ½æ–‡ä»¶æ¸…ç†
- ğŸ“ è¯¦ç»†çš„è½¬å½•ç»“æœï¼ˆåŒ…å«æ—¶é—´æˆ³ï¼‰
- ğŸ›¡ï¸ å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ–‡ä»¶éªŒè¯
- ğŸ“¦ å†…ç½® FFmpegï¼Œæ— éœ€é¢å¤–å®‰è£…

## é¡¹ç›®ç»“æ„

```
è§†é¢‘è½¬æ–‡å­—/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.js                    # ä¸»åº”ç”¨æ–‡ä»¶
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ transcription.js      # è½¬å½•ç›¸å…³è·¯ç”±
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ whisperService.js     # Whisper API æœåŠ¡
â”‚   â””â”€â”€ middleware/
â”‚       â”œâ”€â”€ fileValidation.js     # æ–‡ä»¶éªŒè¯ä¸­é—´ä»¶
â”‚       â””â”€â”€ errorHandler.js       # é”™è¯¯å¤„ç†ä¸­é—´ä»¶
â”œâ”€â”€ uploads/                      # æ–‡ä»¶ä¸Šä¼ ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”œâ”€â”€ package.json
â”œâ”€â”€ .env                         # ç¯å¢ƒå˜é‡é…ç½®
â””â”€â”€ README.md
```

## å®‰è£…é…ç½®

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ä½ çš„ OpenAI API Keyï¼š

```env
OPENAI_API_KEY=your_openai_api_key_here
PORT=3000
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=100MB
```

**æ³¨æ„**: FFmpeg å·²é€šè¿‡ `@ffmpeg-installer/ffmpeg` åŒ…è‡ªåŠ¨åŒ…å«ï¼Œæ— éœ€æ‰‹åŠ¨å®‰è£…ï¼

## ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨æœåŠ¡

```bash
# ç”Ÿäº§ç¯å¢ƒ
npm start

# å¼€å‘ç¯å¢ƒï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
npm run dev
```

æœåŠ¡å¯åŠ¨åè®¿é—®ï¼šhttp://localhost:3000

### API æ¥å£

#### 1. è½¬å½•è§†é¢‘/éŸ³é¢‘

**POST** `/api/transcription/transcribe`

**è¯·æ±‚å‚æ•°ï¼š**
- `file` (å¿…éœ€): è§†é¢‘æˆ–éŸ³é¢‘æ–‡ä»¶
- `language` (å¯é€‰): è¯­è¨€ä»£ç , é»˜è®¤ 'zh' (ä¸­æ–‡)
- `prompt` (å¯é€‰): æç¤ºè¯ï¼Œç”¨äºæ”¹å–„è½¬å½•è´¨é‡
- `temperature` (å¯é€‰): 0-1 ä¹‹é—´çš„æ•°å€¼ï¼Œæ§åˆ¶éšæœºæ€§
- `response_format` (å¯é€‰): å“åº”æ ¼å¼ï¼Œé»˜è®¤ 'json'

**ç¤ºä¾‹è¯·æ±‚ï¼š**
```bash
curl -X POST http://localhost:3000/api/transcription/transcribe \
  -F "file=@video.mp4" \
  -F "language=zh" \
  -F "prompt=è¿™æ˜¯ä¸€ä¸ªå…³äºæŠ€æœ¯çš„è§†é¢‘"
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "è½¬å½•å®Œæˆ",
  "data": {
    "filename": "video.mp4",
    "transcription": "è¿™é‡Œæ˜¯è½¬å½•çš„æ–‡å­—å†…å®¹...",
    "language": "chinese",
    "duration": 120.5,
    "segments": [
      {
        "start": 0.0,
        "end": 5.2,
        "text": "ç¬¬ä¸€æ®µæ–‡å­—..."
      }
    ]
  }
}
```

#### 2. è·å–æ”¯æŒçš„æ–‡ä»¶æ ¼å¼

**GET** `/api/transcription/formats`

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "data": {
    "video": ["mp4", "avi", "mov", "wmv", "flv"],
    "audio": ["mp3", "wav", "m4a", "flac"],
    "maxSize": "100MB"
  }
}
```

#### 3. å¥åº·æ£€æŸ¥

**GET** `/health`

## æ”¯æŒçš„è¯­è¨€

- `zh` - ä¸­æ–‡
- `en` - è‹±è¯­
- `ja` - æ—¥è¯­
- `ko` - éŸ©è¯­
- `es` - è¥¿ç­ç‰™è¯­
- `fr` - æ³•è¯­
- `de` - å¾·è¯­
- æ›´å¤šè¯­è¨€è¯·å‚è€ƒ [OpenAI Whisper æ–‡æ¡£](https://platform.openai.com/docs/guides/speech-to-text)

## æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶å¤§å°é™åˆ¶**: æœ€å¤§æ”¯æŒ 100MB çš„æ–‡ä»¶
2. **API Key**: éœ€è¦æœ‰æ•ˆçš„ OpenAI API Key
3. **FFmpeg**: FFmpeg å·²è‡ªåŠ¨åŒ…å«ï¼Œæ— éœ€é¢å¤–å®‰è£…
4. **æ–‡ä»¶æ¸…ç†**: ä¸Šä¼ çš„æ–‡ä»¶å¤„ç†å®Œæˆåä¼šè‡ªåŠ¨åˆ é™¤
5. **ç½‘ç»œ**: è½¬å½•è¿‡ç¨‹éœ€è¦ç½‘ç»œè¿æ¥åˆ° OpenAI API

## é”™è¯¯å¤„ç†

æœåŠ¡åŒ…å«å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š

- æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ
- æ–‡ä»¶å¤§å°è¶…é™
- OpenAI API é”™è¯¯
- FFmpeg å¤„ç†é”™è¯¯
- ç½‘ç»œè¿æ¥é”™è¯¯

æ‰€æœ‰é”™è¯¯éƒ½ä¼šè¿”å›å‹å¥½çš„ä¸­æ–‡é”™è¯¯ä¿¡æ¯ã€‚

## å¼€å‘

### å¯åŠ¨å¼€å‘æ¨¡å¼

```bash
npm run dev
```

### è¿è¡Œæµ‹è¯•

```bash
npm test
```

## è®¸å¯è¯

MIT License